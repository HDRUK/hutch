"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[8462],{8570:(e,t,r)=>{r.d(t,{Zo:()=>p,kt:()=>h});var n=r(79);function o(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function s(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function a(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?s(Object(r),!0).forEach((function(t){o(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):s(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function i(e,t){if(null==e)return{};var r,n,o=function(e,t){if(null==e)return{};var r,n,o={},s=Object.keys(e);for(n=0;n<s.length;n++)r=s[n],t.indexOf(r)>=0||(o[r]=e[r]);return o}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(n=0;n<s.length;n++)r=s[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}var l=n.createContext({}),c=function(e){var t=n.useContext(l),r=t;return e&&(r="function"==typeof e?e(t):a(a({},t),e)),r},p=function(e){var t=c(e.components);return n.createElement(l.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},d=n.forwardRef((function(e,t){var r=e.components,o=e.mdxType,s=e.originalType,l=e.parentName,p=i(e,["components","mdxType","originalType","parentName"]),d=c(r),h=o,g=d["".concat(l,".").concat(h)]||d[h]||u[h]||s;return r?n.createElement(g,a(a({ref:t},p),{},{components:r})):n.createElement(g,a({ref:t},p))}));function h(e,t){var r=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var s=r.length,a=new Array(s);a[0]=d;var i={};for(var l in t)hasOwnProperty.call(t,l)&&(i[l]=t[l]);i.originalType=e,i.mdxType="string"==typeof e?e:o,a[1]=i;for(var c=2;c<s;c++)a[c]=r[c];return n.createElement.apply(null,a)}return n.createElement.apply(null,r)}d.displayName="MDXCreateElement"},5536:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>l,contentTitle:()=>a,default:()=>u,frontMatter:()=>s,metadata:()=>i,toc:()=>c});var n=r(2203),o=(r(79),r(8570));const s={sidebar_position:2},a="Docker on Nexus",i={unversionedId:"devs/external-systems/nexus/docker_repo",id:"devs/external-systems/nexus/docker_repo",title:"Docker on Nexus",description:"Making a hosted Docker registry",source:"@site/docs/devs/external-systems/nexus/docker_repo.md",sourceDirName:"devs/external-systems/nexus",slug:"/devs/external-systems/nexus/docker_repo",permalink:"/hutch/docs/devs/external-systems/nexus/docker_repo",draft:!1,editUrl:"https://github.com/hdruk/hutch/tree/main/website/docs/devs/external-systems/nexus/docker_repo.md",tags:[],version:"current",sidebarPosition:2,frontMatter:{sidebar_position:2},sidebar:"devGuide",previous:{title:"Using Nexus",permalink:"/hutch/docs/devs/external-systems/nexus/using_nexus"},next:{title:"WfExS",permalink:"/hutch/docs/devs/external-systems/wfexs/"}},l={},c=[{value:"Making a hosted Docker registry",id:"making-a-hosted-docker-registry",level:2},{value:"Making a Proxy for Docker Hub",id:"making-a-proxy-for-docker-hub",level:2},{value:"Pushing and pulling the Docker registry",id:"pushing-and-pulling-the-docker-registry",level:2},{value:"Pushing",id:"pushing",level:3},{value:"Pulling",id:"pulling",level:3}],p={toc:c};function u(e){let{components:t,...s}=e;return(0,o.kt)("wrapper",(0,n.Z)({},p,s,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"docker-on-nexus"},"Docker on Nexus"),(0,o.kt)("h2",{id:"making-a-hosted-docker-registry"},"Making a hosted Docker registry"),(0,o.kt)("p",null,"Navigate to the web portal in the web browaser (",(0,o.kt)("inlineCode",{parentName:"p"},"localhost:8081"),", or the port you mapped the portal to on the host) and sign in."),(0,o.kt)("admonition",{type:"note"},(0,o.kt)("p",{parentName:"admonition"},"The first time you attempt to login, it will give you the username and tell you to find the admin password (see above). Once logged in you will be promtped to provide a new password for the admin user.")),(0,o.kt)("p",null,'Go to the server administration tab and select "Repositories" under "Repository".'),(0,o.kt)("hr",null),(0,o.kt)("p",null,(0,o.kt)("img",{src:r(6131).Z,width:"928",height:"548"})),(0,o.kt)("p",null,'Click "Create repository" and the select "Docker (hosted)" from the list.'),(0,o.kt)("hr",null),(0,o.kt)("p",null,(0,o.kt)("img",{src:r(1068).Z,width:"1392",height:"760"})),(0,o.kt)("p",null,(0,o.kt)("img",{src:r(5220).Z,width:"1412",height:"1116"})),(0,o.kt)("p",null,"Give the repository a name and allocate one of the additional ports you specified when running the container. You can either do HTTP (not recommended for production), and/or HTTPS. You will need a separate port for each."),(0,o.kt)("hr",null),(0,o.kt)("p",null,(0,o.kt)("img",{src:r(2632).Z,width:"1776",height:"966"})),(0,o.kt)("h2",{id:"making-a-proxy-for-docker-hub"},"Making a Proxy for Docker Hub"),(0,o.kt)("p",null,'To create a Docker Hub proxy, follow the above steps. However, this time choose "docker (proxy)" from the menu. Set up the port as above. Under the "Proxy" settings, add "',(0,o.kt)("a",{parentName:"p",href:"https://registry-1.docker.io%22"},'https://registry-1.docker.io"'),' under "Remote storage". Tick "Use the Nexus Repository truststore" and select "Use Docker Hub".'),(0,o.kt)("hr",null),(0,o.kt)("p",null,(0,o.kt)("img",{src:r(2432).Z,width:"2046",height:"602"})),(0,o.kt)("p",null,"When you pull from the proxy registry, the images are cached on Nexus."),(0,o.kt)("hr",null),(0,o.kt)("p",null,(0,o.kt)("img",{src:r(6829).Z,width:"952",height:"730"})),(0,o.kt)("h2",{id:"pushing-and-pulling-the-docker-registry"},"Pushing and pulling the Docker registry"),(0,o.kt)("admonition",{type:"note"},(0,o.kt)("p",{parentName:"admonition"},"These steps work for both Hosted and Proxy registries.")),(0,o.kt)("h3",{id:"pushing"},"Pushing"),(0,o.kt)("p",null,"First, login to the resgistry."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell"},"docker login localhost:8082\n")),(0,o.kt)("p",null,"Give the user name and password for account on Nexus, such as the admin account, when asked."),(0,o.kt)("p",null,"Tag your image with the path to the registry."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell"},"docker tag <my image> localhost:8082/<my image>:<some tag>\n")),(0,o.kt)("p",null,"Then push the new tag."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell"},"docker push localhost:8082/<my image>:<some tag>\n")),(0,o.kt)("h3",{id:"pulling"},"Pulling"),(0,o.kt)("p",null,"First, login to the resgistry."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell"},"docker login localhost:8082\n")),(0,o.kt)("p",null,"Then pull the new tag."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell"},"docker pull localhost:8082/<my image>:<some tag>\n")))}u.isMDXComponent=!0},1068:(e,t,r)=>{r.d(t,{Z:()=>n});const n=r.p+"assets/images/create-repo-733187ceebdc4b2d9e917455366826c9.png"},2432:(e,t,r)=>{r.d(t,{Z:()=>n});const n=r.p+"assets/images/docker-proxy-settings-2a4c8797ca4499c4698b6a7544b03562.png"},6131:(e,t,r)=>{r.d(t,{Z:()=>n});const n=r.p+"assets/images/find-repos-4e48e76bcfbcaa076f1c589542a7ae0c.png"},6829:(e,t,r)=>{r.d(t,{Z:()=>n});const n=r.p+"assets/images/proxy-contents-4c1b6ef36449ed121f9bb9b6cfcc3318.png"},5220:(e,t,r)=>{r.d(t,{Z:()=>n});const n=r.p+"assets/images/repo-kind-d977991c1e6656cd4c3facc1bb0a90da.png"},2632:(e,t,r)=>{r.d(t,{Z:()=>n});const n=r.p+"assets/images/setup-repo-4935aeeacf4f5398c15098917c1cb430.png"}}]);